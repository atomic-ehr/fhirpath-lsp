{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://schemas.atomic-ehr.com/fhirpath-lsp/config.schema.json",
  "title": "FHIRPath LSP Configuration",
  "description": "Configuration schema for FHIRPath Language Server Protocol extension",
  "type": "object",
  "properties": {
    "enabled": {
      "type": "boolean",
      "default": true,
      "description": "Enable/disable the FHIRPath LSP extension"
    },
    "version": {
      "type": "string",
      "description": "Configuration version",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "diagnostics": {
      "type": "object",
      "description": "Diagnostic analysis configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable diagnostic analysis"
        },
        "performance": {
          "type": "object",
          "description": "Performance analyzer settings",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable performance analysis"
            },
            "maxComplexity": {
              "type": "number",
              "minimum": 1,
              "maximum": 50,
              "default": 10,
              "description": "Maximum allowed expression complexity"
            },
            "maxNestingDepth": {
              "type": "number",
              "minimum": 1,
              "maximum": 20,
              "default": 5,
              "description": "Maximum allowed nesting depth"
            },
            "flagRedundantOperations": {
              "type": "boolean",
              "default": true,
              "description": "Flag redundant operations"
            },
            "flagExpensiveOperations": {
              "type": "boolean",
              "default": true,
              "description": "Flag expensive operations"
            }
          },
          "additionalProperties": false
        },
        "codeQuality": {
          "type": "object",
          "description": "Code quality analyzer settings",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable code quality analysis"
            },
            "maxLineLength": {
              "type": "number",
              "minimum": 50,
              "maximum": 200,
              "default": 100,
              "description": "Maximum line length"
            },
            "enforceNamingConventions": {
              "type": "boolean",
              "default": false,
              "description": "Enforce naming conventions"
            },
            "flagMagicValues": {
              "type": "boolean",
              "default": true,
              "description": "Flag magic values in expressions"
            },
            "requireDocumentation": {
              "type": "boolean",
              "default": false,
              "description": "Require documentation comments"
            }
          },
          "additionalProperties": false
        },
        "fhirBestPractices": {
          "type": "object",
          "description": "FHIR best practices analyzer settings",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable FHIR best practices analysis"
            },
            "enforceTypeSafety": {
              "type": "boolean",
              "default": true,
              "description": "Enforce type safety in expressions"
            },
            "flagDeprecatedElements": {
              "type": "boolean",
              "default": true,
              "description": "Flag usage of deprecated FHIR elements"
            },
            "suggestOptimizations": {
              "type": "boolean",
              "default": true,
              "description": "Suggest expression optimizations"
            },
            "checkCardinality": {
              "type": "boolean",
              "default": false,
              "description": "Check FHIR element cardinality constraints"
            }
          },
          "additionalProperties": false
        },
        "maintainability": {
          "type": "object",
          "description": "Maintainability analyzer settings",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable maintainability analysis"
            },
            "maxFunctionComplexity": {
              "type": "number",
              "minimum": 1,
              "maximum": 30,
              "default": 8,
              "description": "Maximum function complexity"
            },
            "flagDuplication": {
              "type": "boolean",
              "default": true,
              "description": "Flag code duplication"
            },
            "enforceConsistency": {
              "type": "boolean",
              "default": true,
              "description": "Enforce coding consistency"
            }
          },
          "additionalProperties": false
        },
        "severity": {
          "type": "object",
          "description": "Diagnostic severity levels",
          "properties": {
            "performance": {
              "type": "number",
              "enum": [1, 2, 3, 4],
              "default": 2,
              "description": "Performance diagnostic severity (1=Error, 2=Warning, 3=Info, 4=Hint)"
            },
            "codeQuality": {
              "type": "number", 
              "enum": [1, 2, 3, 4],
              "default": 3,
              "description": "Code quality diagnostic severity"
            },
            "fhirBestPractices": {
              "type": "number",
              "enum": [1, 2, 3, 4],
              "default": 2,
              "description": "FHIR best practices diagnostic severity"
            },
            "maintainability": {
              "type": "number",
              "enum": [1, 2, 3, 4],
              "default": 3,
              "description": "Maintainability diagnostic severity"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "providers": {
      "type": "object",
      "description": "Language server provider configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable LSP providers"
        },
        "modelProvider": {
          "type": "object",
          "description": "FHIR model provider configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable FHIR model provider"
            },
            "required": {
              "type": "boolean",
              "default": false,
              "description": "Require model provider for LSP functionality"
            },
            "fhirModelProvider": {
              "type": "object",
              "description": "FHIR model provider settings",
              "properties": {
                "packages": {
                  "type": "array",
                  "description": "FHIR packages to load",
                  "items": {
                    "type": "object",
                    "properties": {
                      "name": {
                        "type": "string",
                        "description": "Package name (e.g., 'hl7.fhir.r4.core')"
                      },
                      "version": {
                        "type": "string",
                        "description": "Package version (e.g., '4.0.1')"
                      }
                    },
                    "required": ["name", "version"],
                    "additionalProperties": false
                  },
                  "default": [{"name": "hl7.fhir.r4.core", "version": "4.0.1"}]
                },
                "cacheDir": {
                  "type": "string",
                  "default": ".fhir-cache",
                  "description": "Directory for FHIR package cache"
                },
                "registryUrl": {
                  "type": "string",
                  "format": "uri",
                  "default": "https://fs.get-ig.org/pkgs",
                  "description": "FHIR package registry URL"
                }
              },
              "additionalProperties": false
            },
            "caching": {
              "type": "object",
              "description": "Model provider caching settings",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable caching"
                },
                "ttl": {
                  "type": "number",
                  "minimum": 60000,
                  "maximum": 3600000,
                  "default": 600000,
                  "description": "Cache time-to-live in milliseconds"
                },
                "maxSize": {
                  "type": "number",
                  "minimum": 100,
                  "maximum": 10000,
                  "default": 1000,
                  "description": "Maximum cache size"
                }
              },
              "additionalProperties": false
            },
          },
          "additionalProperties": false
        },
        "healthCheck": {
          "type": "object",
          "description": "Health check configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable health checks"
            },
            "intervalMs": {
              "type": "number",
              "minimum": 30000,
              "maximum": 300000,
              "default": 60000,
              "description": "Health check interval in milliseconds"
            },
            "timeoutMs": {
              "type": "number",
              "minimum": 1000,
              "maximum": 30000,
              "default": 5000,
              "description": "Health check timeout in milliseconds"
            },
            "maxFailures": {
              "type": "number",
              "minimum": 1,
              "maximum": 10,
              "default": 3,
              "description": "Maximum health check failures before marking as unhealthy"
            }
          },
          "additionalProperties": false
        },
        "enhanced": {
          "type": "object",
          "description": "Enhanced provider features",
          "properties": {
            "completion": {
              "type": "object",
              "description": "Enhanced completion settings",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable enhanced completions"
                },
                "enhanced": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable advanced completion features"
                },
                "choiceTypes": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable choice type completions"
                },
                "inheritance": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable inheritance-based completions"
                },
                "deepNavigation": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable deep navigation completions"
                },
                "maxCompletions": {
                  "type": "number",
                  "minimum": 10,
                  "maximum": 500,
                  "default": 100,
                  "description": "Maximum number of completions"
                },
                "contextAware": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable context-aware completions based on resource type"
                },
                "smartSuggestions": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable smart completion suggestions"
                },
                "includePrivateElements": {
                  "type": "boolean",
                  "default": false,
                  "description": "Include private/internal FHIR elements in completions"
                },
                "priorityWeighting": {
                  "type": "object",
                  "description": "Completion priority weighting factors",
                  "properties": {
                    "commonElements": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 10,
                      "default": 3,
                      "description": "Weight for commonly used elements"
                    },
                    "recentlyUsed": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 10,
                      "default": 2,
                      "description": "Weight for recently used elements"
                    },
                    "typeRelevance": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 10,
                      "default": 5,
                      "description": "Weight for type relevance"
                    }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            },
            "hover": {
              "type": "object",
              "description": "Enhanced hover settings",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable enhanced hover"
                },
                "enhanced": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable advanced hover features"
                },
                "showHierarchy": {
                  "type": "boolean",
                  "default": true,
                  "description": "Show type hierarchy in hover"
                },
                "showConstraints": {
                  "type": "boolean",
                  "default": true,
                  "description": "Show constraints in hover"
                },
                "showTerminology": {
                  "type": "boolean",
                  "default": true,
                  "description": "Show terminology bindings in hover"
                }
              },
              "additionalProperties": false
            },
            "diagnostics": {
              "type": "object",
              "description": "Enhanced diagnostic settings",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable enhanced diagnostics"
                },
                "typeAware": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable type-aware diagnostics"
                },
                "strictMode": {
                  "type": "boolean",
                  "default": false,
                  "description": "Enable strict mode diagnostics"
                },
                "enableSuggestions": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable diagnostic suggestions"
                },
                "maxSuggestions": {
                  "type": "number",
                  "minimum": 1,
                  "maximum": 20,
                  "default": 5,
                  "description": "Maximum number of suggestions"
                }
              },
              "additionalProperties": false
            },
            "refactoring": {
              "type": "object",
              "description": "Enhanced refactoring settings",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable enhanced refactoring"
                },
                "smart": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable smart refactoring suggestions"
                },
                "enableOptimizations": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable expression optimization suggestions"
                }
              },
              "additionalProperties": false
            },
            "semanticFiltering": {
              "type": "object",
              "description": "Semantic filtering options for completions",
              "properties": {
                "filterByScope": {
                  "type": "boolean",
                  "default": true,
                  "description": "Filter completions based on current scope"
                },
                "filterByCardinality": {
                  "type": "boolean",
                  "default": true,
                  "description": "Filter completions based on element cardinality"
                },
                "filterByContext": {
                  "type": "boolean",
                  "default": true,
                  "description": "Filter completions based on expression context"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "completion": {
          "type": "object",
          "description": "Completion provider settings",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable completion provider"
            },
            "maxSuggestions": {
              "type": "number",
              "minimum": 1,
              "maximum": 200,
              "default": 50,
              "description": "Maximum number of completion suggestions"
            },
            "includeSnippets": {
              "type": "boolean",
              "default": true,
              "description": "Include code snippets in completions"
            },
            "includeDocumentation": {
              "type": "boolean",
              "default": true,
              "description": "Include documentation in completions"
            },
            "fuzzyMatching": {
              "type": "boolean",
              "default": true,
              "description": "Enable fuzzy matching for completions"
            },
            "sortByRelevance": {
              "type": "boolean",
              "default": true,
              "description": "Sort completions by relevance"
            },
            "triggerCharacters": {
              "type": "array",
              "description": "Characters that trigger completion",
              "items": {
                "type": "string",
                "maxLength": 1
              },
              "default": [".", "(", "[", "'", "\""]
            },
            "suggestionDelay": {
              "type": "number",
              "minimum": 0,
              "maximum": 2000,
              "default": 300,
              "description": "Delay before showing suggestions in milliseconds"
            },
            "enablePostfixSnippets": {
              "type": "boolean",
              "default": true,
              "description": "Enable postfix snippet completions (e.g., .where, .select)"
            },
            "enableFunctionTemplates": {
              "type": "boolean",
              "default": true,
              "description": "Enable function template completions with parameter hints"
            },
            "enableTypeHints": {
              "type": "boolean",
              "default": true,
              "description": "Show type hints in completion items"
            },
            "enableParameterHints": {
              "type": "boolean",
              "default": true,
              "description": "Show parameter hints for functions"
            },
            "enablePreviewText": {
              "type": "boolean",
              "default": true,
              "description": "Show preview text for complex completions"
            },
            "autoImportSuggestions": {
              "type": "boolean",
              "default": true,
              "description": "Enable auto-import suggestions for external resources"
            },
            "enableIntelliSenseCache": {
              "type": "boolean",
              "default": true,
              "description": "Enable IntelliSense caching for better performance"
            },
            "cacheSize": {
              "type": "number",
              "minimum": 100,
              "maximum": 5000,
              "default": 1000,
              "description": "IntelliSense cache size"
            }
          },
          "additionalProperties": false
        },
        "hover": {
          "type": "object",
          "description": "Hover provider settings",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable hover provider"
            },
            "includeDocumentation": {
              "type": "boolean",
              "default": true,
              "description": "Include documentation in hover"
            },
            "includeExamples": {
              "type": "boolean",
              "default": false,
              "description": "Include examples in hover"
            },
            "maxContentLength": {
              "type": "number",
              "minimum": 100,
              "maximum": 5000,
              "default": 1000,
              "description": "Maximum hover content length"
            },
            "showTypeInformation": {
              "type": "boolean",
              "default": true,
              "description": "Show type information in hover"
            }
          },
          "additionalProperties": false
        },
      },
      "additionalProperties": false
    },
    "logging": {
      "type": "object",
      "description": "Logging configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable logging"
        },
        "level": {
          "type": "string",
          "enum": ["error", "warn", "info", "debug"],
          "default": "info",
          "description": "Logging level"
        },
        "console": {
          "type": "object",
          "description": "Console logging settings",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable console logging"
            },
            "colorize": {
              "type": "boolean",
              "default": false,
              "description": "Enable colorized console output"
            },
            "includeTimestamp": {
              "type": "boolean",
              "default": true,
              "description": "Include timestamp in console logs"
            }
          },
          "additionalProperties": false
        },
        "file": {
          "type": "object",
          "description": "File logging settings",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Enable file logging"
            },
            "path": {
              "type": "string",
              "default": "./logs/fhirpath-lsp.log",
              "description": "Log file path"
            },
            "maxSize": {
              "type": "number",
              "minimum": 1024,
              "maximum": 104857600,
              "default": 10485760,
              "description": "Maximum log file size in bytes (1KB to 100MB)"
            },
            "maxFiles": {
              "type": "number",
              "minimum": 1,
              "maximum": 50,
              "default": 5,
              "description": "Maximum number of log files to keep"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}